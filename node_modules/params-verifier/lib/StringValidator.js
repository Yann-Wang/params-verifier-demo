'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _isNan = require('babel-runtime/core-js/number/is-nan');

var _isNan2 = _interopRequireDefault(_isNan);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _Err = require('./Err');

var _ValidatorBase2 = require('./ValidatorBase');

var _ValidatorBase3 = _interopRequireDefault(_ValidatorBase2);

var _dataType = require('./dataType');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var StringValidator = function (_ValidatorBase) {
    (0, _inherits3.default)(StringValidator, _ValidatorBase);

    function StringValidator(data, options) {
        (0, _classCallCheck3.default)(this, StringValidator);

        var _this = (0, _possibleConstructorReturn3.default)(this, (StringValidator.__proto__ || (0, _getPrototypeOf2.default)(StringValidator)).call(this));

        _this.businessTypeList = ['mobile', 'id_card', 'passport', 'email', 'date'];
        _this.type = 'string';
        _this.value = data;
        _this.options = options || {};
        return _this;
    }

    (0, _createClass3.default)(StringValidator, [{
        key: 'singleField',
        value: function singleField(name, options) {
            this.currentFieldInfo = this.fetchFieldInfo(name, this.value, this.type, options);
            this.validate();
        }
    }, {
        key: 'checkOptionsParamsSupport',
        value: function checkOptionsParamsSupport() {
            this.checkOptionsBusinessType();
            this.checkOptionsValidator();
            this.checkOptionsRequired();
            this.checkOptionsStringNotEmpty();
        }
    }, {
        key: 'checkOptionsBusinessType',
        value: function checkOptionsBusinessType() {
            var businessType = this.currentFieldInfo.businessType;

            var types = this.businessTypeList;

            if (businessType !== undefined) {
                if (typeof businessType !== 'string') {
                    throw new _Err.ParamsError('the type of options.type must be string');
                }

                if (types.indexOf(businessType) === -1) {
                    throw new _Err.ParamsError('the value: ' + businessType + ' of options.type is not supported.');
                }
            }
        }
    }, {
        key: 'checkOptionsStringNotEmpty',
        value: function checkOptionsStringNotEmpty() {
            var stringNotEmpty = this.currentFieldInfo.stringNotEmpty;


            if (stringNotEmpty !== undefined) {
                if (typeof stringNotEmpty !== 'boolean') {
                    throw new _Err.ParamsError('the type of options.stringNotEmpty must be boolean');
                }
            }
        }
    }, {
        key: 'startValidateProcedure',
        value: function startValidateProcedure() {
            this.verifyType();
            this.checkStringNotEmpty();
            this.verifyBusinessType();
            this.runValidator();
        }
    }, {
        key: 'checkStringNotEmpty',
        value: function checkStringNotEmpty() {
            var _currentFieldInfo = this.currentFieldInfo,
                stringNotEmpty = _currentFieldInfo.stringNotEmpty,
                value = _currentFieldInfo.value,
                name = _currentFieldInfo.name;


            if (stringNotEmpty) {
                if (value === '') {
                    throw new _Err.ParamsError('the value of field ' + name + ' can\'t be empty.');
                }
            }
        }
    }, {
        key: 'verifyType',
        value: function verifyType() {
            var _currentFieldInfo2 = this.currentFieldInfo,
                value = _currentFieldInfo2.value,
                name = _currentFieldInfo2.name;

            if (!(0, _dataType.isStr)(value)) {
                throw new _Err.ParamsError('the type of ' + name + ' is not string.');
            }
        }
    }, {
        key: 'verifyBusinessType',
        value: function verifyBusinessType() {
            var _currentFieldInfo3 = this.currentFieldInfo,
                businessType = _currentFieldInfo3.businessType,
                businessTypeErrMsg = _currentFieldInfo3.businessTypeErrMsg,
                name = _currentFieldInfo3.name,
                value = _currentFieldInfo3.value,
                type = _currentFieldInfo3.type;


            if (businessType !== undefined) {
                var match = StringValidator.getLambdaExpressByBusinessType(businessType)(value);
                if (!match) {
                    throw new _Err.ParamsError(businessTypeErrMsg || 'the value of field ' + name + ' don\'t match the business type ' + businessType + ' of ' + type);
                }
            }
        }
    }], [{
        key: 'getLambdaExpressByBusinessType',
        value: function getLambdaExpressByBusinessType(businessType) {
            switch (businessType) {
                case 'mobile':
                    return function (value) {
                        return (/^[0-9]{11}$/.test(value)
                        );
                    };
                case 'id_card':
                    return function (value) {
                        return (/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(value)
                        );
                    };
                case 'passport':
                    return function (value) {
                        return (/(^[a-zA-Z]{5,17}$)|(^[a-zA-Z0-9]{5,17}$)/.test(value)
                        );
                    };
                case 'email':
                    return function (value) {
                        return (/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(value)
                        );
                    };
                case 'date':
                    return function (value) {
                        var date = new Date(value);
                        return Object.prototype.toString.call(date) === '[object Date]' && !(0, _isNan2.default)(date.getTime());
                    };
                default:
                    throw new Error('the business type of ' + businessType + ' for string is not defined.');
            }
        }
    }]);
    return StringValidator;
}(_ValidatorBase3.default);

exports.default = StringValidator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TdHJpbmdWYWxpZGF0b3IuanMiXSwibmFtZXMiOlsiU3RyaW5nVmFsaWRhdG9yIiwiZGF0YSIsIm9wdGlvbnMiLCJidXNpbmVzc1R5cGVMaXN0IiwidHlwZSIsInZhbHVlIiwibmFtZSIsImN1cnJlbnRGaWVsZEluZm8iLCJmZXRjaEZpZWxkSW5mbyIsInZhbGlkYXRlIiwiY2hlY2tPcHRpb25zQnVzaW5lc3NUeXBlIiwiY2hlY2tPcHRpb25zVmFsaWRhdG9yIiwiY2hlY2tPcHRpb25zUmVxdWlyZWQiLCJjaGVja09wdGlvbnNTdHJpbmdOb3RFbXB0eSIsImJ1c2luZXNzVHlwZSIsInR5cGVzIiwidW5kZWZpbmVkIiwiaW5kZXhPZiIsInN0cmluZ05vdEVtcHR5IiwidmVyaWZ5VHlwZSIsImNoZWNrU3RyaW5nTm90RW1wdHkiLCJ2ZXJpZnlCdXNpbmVzc1R5cGUiLCJydW5WYWxpZGF0b3IiLCJidXNpbmVzc1R5cGVFcnJNc2ciLCJtYXRjaCIsImdldExhbWJkYUV4cHJlc3NCeUJ1c2luZXNzVHlwZSIsInRlc3QiLCJkYXRlIiwiRGF0ZSIsIk9iamVjdCIsInByb3RvdHlwZSIsInRvU3RyaW5nIiwiY2FsbCIsImdldFRpbWUiLCJFcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7Ozs7QUFDQTs7OztJQUVxQkEsZTs7O0FBQ2pCLDZCQUFZQyxJQUFaLEVBQWtCQyxPQUFsQixFQUEyQjtBQUFBOztBQUFBOztBQUd2QixjQUFLQyxnQkFBTCxHQUF3QixDQUFDLFFBQUQsRUFBVyxTQUFYLEVBQXNCLFVBQXRCLEVBQWtDLE9BQWxDLEVBQTJDLE1BQTNDLENBQXhCO0FBQ0EsY0FBS0MsSUFBTCxHQUFZLFFBQVo7QUFDQSxjQUFLQyxLQUFMLEdBQWFKLElBQWI7QUFDQSxjQUFLQyxPQUFMLEdBQWVBLFdBQVcsRUFBMUI7QUFOdUI7QUFPMUI7Ozs7b0NBRVdJLEksRUFBTUosTyxFQUFTO0FBQ3ZC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QkFBVSw0Q0FBMkNxQixJQUEzQyxDQUFnRHJCLEtBQWhEO0FBQVY7QUFBQSxxQkFBUDtBQUNKLHFCQUFLLE9BQUw7QUFDSSwyQkFBTztBQUFBLCtCQUFVLHdKQUF1SnFCLElBQXZKLENBQTRKckIsS0FBNUo7QUFBVjtBQUFBLHFCQUFQO0FBQ0oscUJBQUssTUFBTDtBQUNJLDJCQUFPLFVBQUNBLEtBQUQsRUFBVztBQUNkLDRCQUFNc0IsT0FBTyxJQUFJQyxJQUFKLENBQVN2QixLQUFULENBQWI7QUFDQSwrQkFBT3dCLE9BQU9DLFNBQVAsQ0FBaUJDLFFBQWpCLENBQTBCQyxJQUExQixDQUErQkwsSUFBL0IsTUFBeUMsZUFBekMsSUFBNEQsQ0FBQyxxQkFBYUEsS0FBS00sT0FBTCxFQUFiLENBQXBFO0FBQ0gscUJBSEQ7QUFJSjtBQUNJLDBCQUFNLElBQUlDLEtBQUosMkJBQWtDcEIsWUFBbEMsaUNBQU47QUFmUjtBQWlCSDs7Ozs7a0JBdkdnQmQsZSIsImZpbGUiOiJTdHJpbmdWYWxpZGF0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYXJhbXNFcnJvciB9IGZyb20gJy4vRXJyJztcbmltcG9ydCBWYWxpZGF0b3JCYXNlIGZyb20gJy4vVmFsaWRhdG9yQmFzZSc7XG5pbXBvcnQgeyBpc1N0ciB9IGZyb20gJy4vZGF0YVR5cGUnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTdHJpbmdWYWxpZGF0b3IgZXh0ZW5kcyBWYWxpZGF0b3JCYXNlIHtcbiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5idXNpbmVzc1R5cGVMaXN0ID0gWydtb2JpbGUnLCAnaWRfY2FyZCcsICdwYXNzcG9ydCcsICdlbWFpbCcsICdkYXRlJ107XG4gICAgICAgIHRoaXMudHlwZSA9ICdzdHJpbmcnO1xuICAgICAgICB0aGlzLnZhbHVlID0gZGF0YTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICB9XG5cbiAgICBzaW5nbGVGaWVsZChuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuY3VycmVudEZpZWxkSW5mbyA9IHRoaXMuZmV0Y2hGaWVsZEluZm8obmFtZSwgdGhpcy52YWx1ZSwgdGhpcy50eXBlLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy52YWxpZGF0ZSgpO1xuICAgIH1cblxuICAgIGNoZWNrT3B0aW9uc1BhcmFtc1N1cHBvcnQoKSB7XG4gICAgICAgIHRoaXMuY2hlY2tPcHRpb25zQnVzaW5lc3NUeXBlKCk7XG4gICAgICAgIHRoaXMuY2hlY2tPcHRpb25zVmFsaWRhdG9yKCk7XG4gICAgICAgIHRoaXMuY2hlY2tPcHRpb25zUmVxdWlyZWQoKTtcbiAgICAgICAgdGhpcy5jaGVja09wdGlvbnNTdHJpbmdOb3RFbXB0eSgpO1xuICAgIH1cblxuICAgIGNoZWNrT3B0aW9uc0J1c2luZXNzVHlwZSgpIHtcbiAgICAgICAgY29uc3QgeyBidXNpbmVzc1R5cGUgfSA9IHRoaXMuY3VycmVudEZpZWxkSW5mbztcbiAgICAgICAgY29uc3QgdHlwZXMgPSB0aGlzLmJ1c2luZXNzVHlwZUxpc3Q7XG5cbiAgICAgICAgaWYgKGJ1c2luZXNzVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGJ1c2luZXNzVHlwZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUGFyYW1zRXJyb3IoJ3RoZSB0eXBlIG9mIG9wdGlvbnMudHlwZSBtdXN0IGJlIHN0cmluZycpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodHlwZXMuaW5kZXhPZihidXNpbmVzc1R5cGUpID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBQYXJhbXNFcnJvcihgdGhlIHZhbHVlOiAke2J1c2luZXNzVHlwZX0gb2Ygb3B0aW9ucy50eXBlIGlzIG5vdCBzdXBwb3J0ZWQuYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjaGVja09wdGlvbnNTdHJpbmdOb3RFbXB0eSgpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdOb3RFbXB0eSB9ID0gdGhpcy5jdXJyZW50RmllbGRJbmZvO1xuXG4gICAgICAgIGlmIChzdHJpbmdOb3RFbXB0eSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHN0cmluZ05vdEVtcHR5ICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUGFyYW1zRXJyb3IoJ3RoZSB0eXBlIG9mIG9wdGlvbnMuc3RyaW5nTm90RW1wdHkgbXVzdCBiZSBib29sZWFuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGFydFZhbGlkYXRlUHJvY2VkdXJlKCkge1xuICAgICAgICB0aGlzLnZlcmlmeVR5cGUoKTtcbiAgICAgICAgdGhpcy5jaGVja1N0cmluZ05vdEVtcHR5KCk7XG4gICAgICAgIHRoaXMudmVyaWZ5QnVzaW5lc3NUeXBlKCk7XG4gICAgICAgIHRoaXMucnVuVmFsaWRhdG9yKCk7XG4gICAgfVxuXG4gICAgY2hlY2tTdHJpbmdOb3RFbXB0eSgpIHtcbiAgICAgICAgY29uc3QgeyBzdHJpbmdOb3RFbXB0eSwgdmFsdWUsIG5hbWUgfSA9IHRoaXMuY3VycmVudEZpZWxkSW5mbztcblxuICAgICAgICBpZiAoc3RyaW5nTm90RW1wdHkpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUGFyYW1zRXJyb3IoYHRoZSB2YWx1ZSBvZiBmaWVsZCAke25hbWV9IGNhbid0IGJlIGVtcHR5LmApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgdmVyaWZ5VHlwZSgpIHtcbiAgICAgICAgY29uc3QgeyB2YWx1ZSwgbmFtZSB9ID0gdGhpcy5jdXJyZW50RmllbGRJbmZvO1xuICAgICAgICBpZiAoIWlzU3RyKHZhbHVlKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFBhcmFtc0Vycm9yKGB0aGUgdHlwZSBvZiAke25hbWV9IGlzIG5vdCBzdHJpbmcuYCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2ZXJpZnlCdXNpbmVzc1R5cGUoKSB7XG4gICAgICAgIGNvbnN0IHtcbiAgICAgICAgICAgIGJ1c2luZXNzVHlwZSwgYnVzaW5lc3NUeXBlRXJyTXNnLCBuYW1lLCB2YWx1ZSwgdHlwZVxuICAgICAgICB9ID0gdGhpcy5jdXJyZW50RmllbGRJbmZvO1xuXG5cbiAgICAgICAgaWYgKGJ1c2luZXNzVHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjb25zdCBtYXRjaCA9IFN0cmluZ1ZhbGlkYXRvci5nZXRMYW1iZGFFeHByZXNzQnlCdXNpbmVzc1R5cGUoYnVzaW5lc3NUeXBlKSh2YWx1ZSk7XG4gICAgICAgICAgICBpZiAoIW1hdGNoKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBhcmFtc0Vycm9yKGJ1c2luZXNzVHlwZUVyck1zZyB8fCBgdGhlIHZhbHVlIG9mIGZpZWxkICR7bmFtZX0gZG9uJ3QgbWF0Y2ggdGhlIGJ1c2luZXNzIHR5cGUgJHtidXNpbmVzc1R5cGV9IG9mICR7dHlwZX1gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHN0YXRpYyBnZXRMYW1iZGFFeHByZXNzQnlCdXNpbmVzc1R5cGUoYnVzaW5lc3NUeXBlKSB7XG4gICAgICAgIHN3aXRjaCAoYnVzaW5lc3NUeXBlKSB7XG4gICAgICAgICAgICBjYXNlICdtb2JpbGUnOlxuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PiAoL15bMC05XXsxMX0kLy50ZXN0KHZhbHVlKSk7XG4gICAgICAgICAgICBjYXNlICdpZF9jYXJkJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT4gKC8oXlxcZHsxNX0kKXwoXlxcZHsxOH0kKXwoXlxcZHsxN30oXFxkfFh8eCkkKS8udGVzdCh2YWx1ZSkpO1xuICAgICAgICAgICAgY2FzZSAncGFzc3BvcnQnOlxuICAgICAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PiAoLyheW2EtekEtWl17NSwxN30kKXwoXlthLXpBLVowLTldezUsMTd9JCkvLnRlc3QodmFsdWUpKTtcbiAgICAgICAgICAgIGNhc2UgJ2VtYWlsJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWUgPT4gKC9eKChbXjw+KClbXFxdXFxcXC4sOzpcXHNAXCJdKyhcXC5bXjw+KClbXFxdXFxcXC4sOzpcXHNAXCJdKykqKXwoXCIuK1wiKSlAKChcXFtbMC05XXsxLDN9XFwuWzAtOV17MSwzfVxcLlswLTldezEsM31cXC5bMC05XXsxLDN9XSl8KChbYS16QS1aXFwtMC05XStcXC4pK1thLXpBLVpdezIsfSkpJC8udGVzdCh2YWx1ZSkpO1xuICAgICAgICAgICAgY2FzZSAnZGF0ZSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGRhdGUpID09PSAnW29iamVjdCBEYXRlXScgJiYgIU51bWJlci5pc05hTihkYXRlLmdldFRpbWUoKSk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGB0aGUgYnVzaW5lc3MgdHlwZSBvZiAke2J1c2luZXNzVHlwZX0gZm9yIHN0cmluZyBpcyBub3QgZGVmaW5lZC5gKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==