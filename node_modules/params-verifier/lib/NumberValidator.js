'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _Err = require('./Err');

var _ValidatorBase2 = require('./ValidatorBase');

var _ValidatorBase3 = _interopRequireDefault(_ValidatorBase2);

var _dataType = require('./dataType');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var NumberValidator = function (_ValidatorBase) {
    (0, _inherits3.default)(NumberValidator, _ValidatorBase);

    function NumberValidator(data, options) {
        (0, _classCallCheck3.default)(this, NumberValidator);

        var _this = (0, _possibleConstructorReturn3.default)(this, (NumberValidator.__proto__ || (0, _getPrototypeOf2.default)(NumberValidator)).call(this));

        _this.businessTypeList = ['enum'];
        _this.type = 'number';
        _this.value = data;
        _this.options = options || {};
        return _this;
    }

    (0, _createClass3.default)(NumberValidator, [{
        key: 'singleField',
        value: function singleField(name, options) {
            this.currentFieldInfo = this.fetchFieldInfo(name, this.value, this.type, options);
            this.validate();
        }
    }, {
        key: 'checkOptionsParamsSupport',
        value: function checkOptionsParamsSupport() {
            this.checkOptionsBusinessType();
            this.checkOptionsValidator();
            this.checkOptionsRequired();
        }
    }, {
        key: 'checkOptionsBusinessType',
        value: function checkOptionsBusinessType() {
            var _currentFieldInfo = this.currentFieldInfo,
                businessType = _currentFieldInfo.businessType,
                range = _currentFieldInfo.range;

            var types = this.businessTypeList;

            if (businessType !== undefined) {
                if (typeof businessType !== 'string') {
                    throw new _Err.ParamsError('the value of options.type for number must be string');
                }

                if (types.indexOf(businessType) === -1) {
                    throw new _Err.ParamsError('the value: ' + businessType + ' of options.type is not supported.');
                }

                if (businessType === 'enum') {
                    if (!range || !Array.isArray(range) || range.length !== 2 || range.some(function (item) {
                        return typeof item !== 'number' || parseInt(item, 10) !== item;
                    })) {
                        throw new _Err.ParamsError('the value of range field in options for enum type is invalid.');
                    }
                }
            }
        }
    }, {
        key: 'startValidateProcedure',
        value: function startValidateProcedure() {
            this.tryCastType();
            this.verifyType();
            this.verifyBusinessType();
            this.runValidator();
        }
    }, {
        key: 'tryCastType',
        value: function tryCastType() {
            var value = this.currentFieldInfo.value;

            if (typeof value === 'string' && /^[\d]+$/.test(value)) {
                this.currentFieldInfo.value = Number(value);
            }
        }
    }, {
        key: 'verifyType',
        value: function verifyType() {
            var _currentFieldInfo2 = this.currentFieldInfo,
                value = _currentFieldInfo2.value,
                name = _currentFieldInfo2.name;

            if (!(0, _dataType.isNum)(value)) {
                throw new _Err.ParamsError('the type of ' + name + ' is not number.');
            }
        }
    }, {
        key: 'verifyBusinessType',
        value: function verifyBusinessType() {
            var _currentFieldInfo3 = this.currentFieldInfo,
                businessType = _currentFieldInfo3.businessType,
                businessTypeErrMsg = _currentFieldInfo3.businessTypeErrMsg,
                range = _currentFieldInfo3.range,
                value = _currentFieldInfo3.value,
                name = _currentFieldInfo3.name,
                type = _currentFieldInfo3.type;


            if (businessType !== undefined) {
                var match = NumberValidator.getLambdaExpressByBusinessType(businessType)(value, range);
                if (!match) {
                    throw new _Err.ParamsError(businessTypeErrMsg || 'the value of field ' + name + ' don\'t match the business type ' + businessType + ' of ' + type);
                }
            }
        }
    }], [{
        key: 'getLambdaExpressByBusinessType',
        value: function getLambdaExpressByBusinessType(businessType) {
            switch (businessType) {
                case 'enum':
                    return function (value, range) {
                        return value >= range[0] && value <= range[1];
                    };
                default:
                    throw new Error('the business type of ' + businessType + ' for number is not defined.');
            }
        }
    }]);
    return NumberValidator;
}(_ValidatorBase3.default);

exports.default = NumberValidator;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9OdW1iZXJWYWxpZGF0b3IuanMiXSwibmFtZXMiOlsiTnVtYmVyVmFsaWRhdG9yIiwiZGF0YSIsIm9wdGlvbnMiLCJidXNpbmVzc1R5cGVMaXN0IiwidHlwZSIsInZhbHVlIiwibmFtZSIsImN1cnJlbnRGaWVsZEluZm8iLCJmZXRjaEZpZWxkSW5mbyIsInZhbGlkYXRlIiwiY2hlY2tPcHRpb25zQnVzaW5lc3NUeXBlIiwiY2hlY2tPcHRpb25zVmFsaWRhdG9yIiwiY2hlY2tPcHRpb25zUmVxdWlyZWQiLCJidXNpbmVzc1R5cGUiLCJyYW5nZSIsInR5cGVzIiwidW5kZWZpbmVkIiwiaW5kZXhPZiIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsInNvbWUiLCJpdGVtIiwicGFyc2VJbnQiLCJ0cnlDYXN0VHlwZSIsInZlcmlmeVR5cGUiLCJ2ZXJpZnlCdXNpbmVzc1R5cGUiLCJydW5WYWxpZGF0b3IiLCJ0ZXN0IiwiTnVtYmVyIiwiYnVzaW5lc3NUeXBlRXJyTXNnIiwibWF0Y2giLCJnZXRMYW1iZGFFeHByZXNzQnlCdXNpbmVzc1R5cGUiLCJFcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7OztBQUNBOzs7O0lBRXFCQSxlOzs7QUFDakIsNkJBQVlDLElBQVosRUFBa0JDLE9BQWxCLEVBQTJCO0FBQUE7O0FBQUE7O0FBR3ZCLGNBQUtDLGdCQUFMLEdBQXdCLENBQUMsTUFBRCxDQUF4QjtBQUNBLGNBQUtDLElBQUwsR0FBWSxRQUFaO0FBQ0EsY0FBS0MsS0FBTCxHQUFhSixJQUFiO0FBQ0EsY0FBS0MsT0FBTCxHQUFlQSxXQUFXLEVBQTFCO0FBTnVCO0FBTzFCOzs7O29DQUVXSSxJLEVBQU1KLE8sRUFBUztBQUN2QixpQkFBS0ssZ0JBQUwsR0FBd0IsS0FBS0MsY0FBTCxDQUFvQkYsSUFBcEIsRUFBMEIsS0FBS0QsS0FBL0IsRUFBc0MsS0FBS0QsSUFBM0MsRUFBaURGLE9BQWpELENBQXhC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QUFrQ3BCLFlBQWxDLGlDQUFOO0FBTlI7QUFRSDs7Ozs7a0JBOUZnQmIsZSIsImZpbGUiOiJOdW1iZXJWYWxpZGF0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYXJhbXNFcnJvciB9IGZyb20gJy4vRXJyJztcbmltcG9ydCBWYWxpZGF0b3JCYXNlIGZyb20gJy4vVmFsaWRhdG9yQmFzZSc7XG5pbXBvcnQgeyBpc051bSB9IGZyb20gJy4vZGF0YVR5cGUnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBOdW1iZXJWYWxpZGF0b3IgZXh0ZW5kcyBWYWxpZGF0b3JCYXNlIHtcbiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgdGhpcy5idXNpbmVzc1R5cGVMaXN0ID0gWydlbnVtJ107XG4gICAgICAgIHRoaXMudHlwZSA9ICdudW1iZXInO1xuICAgICAgICB0aGlzLnZhbHVlID0gZGF0YTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICB9XG5cbiAgICBzaW5nbGVGaWVsZChuYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuY3VycmVudEZpZWxkSW5mbyA9IHRoaXMuZmV0Y2hGaWVsZEluZm8obmFtZSwgdGhpcy52YWx1ZSwgdGhpcy50eXBlLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy52YWxpZGF0ZSgpO1xuICAgIH1cblxuICAgIGNoZWNrT3B0aW9uc1BhcmFtc1N1cHBvcnQoKSB7XG4gICAgICAgIHRoaXMuY2hlY2tPcHRpb25zQnVzaW5lc3NUeXBlKCk7XG4gICAgICAgIHRoaXMuY2hlY2tPcHRpb25zVmFsaWRhdG9yKCk7XG4gICAgICAgIHRoaXMuY2hlY2tPcHRpb25zUmVxdWlyZWQoKTtcbiAgICB9XG5cbiAgICBjaGVja09wdGlvbnNCdXNpbmVzc1R5cGUoKSB7XG4gICAgICAgIGNvbnN0IHsgYnVzaW5lc3NUeXBlLCByYW5nZSB9ID0gdGhpcy5jdXJyZW50RmllbGRJbmZvO1xuICAgICAgICBjb25zdCB0eXBlcyA9IHRoaXMuYnVzaW5lc3NUeXBlTGlzdDtcblxuICAgICAgICBpZiAoYnVzaW5lc3NUeXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgYnVzaW5lc3NUeXBlICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBQYXJhbXNFcnJvcigndGhlIHZhbHVlIG9mIG9wdGlvbnMudHlwZSBmb3IgbnVtYmVyIG11c3QgYmUgc3RyaW5nJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0eXBlcy5pbmRleE9mKGJ1c2luZXNzVHlwZSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFBhcmFtc0Vycm9yKGB0aGUgdmFsdWU6ICR7YnVzaW5lc3NUeXBlfSBvZiBvcHRpb25zLnR5cGUgaXMgbm90IHN1cHBvcnRlZC5gKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGJ1c2luZXNzVHlwZSA9PT0gJ2VudW0nKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyYW5nZVxuICAgICAgICAgICAgICAgICAgICB8fCAhQXJyYXkuaXNBcnJheShyYW5nZSlcbiAgICAgICAgICAgICAgICAgICAgfHwgcmFuZ2UubGVuZ3RoICE9PSAyXG4gICAgICAgICAgICAgICAgICAgIHx8IHJhbmdlLnNvbWUoaXRlbSA9PiAoXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgaXRlbSAhPT0gJ251bWJlcidcbiAgICAgICAgICAgICAgICAgICAgICAgIHx8IHBhcnNlSW50KGl0ZW0sIDEwKSAhPT0gaXRlbVxuICAgICAgICAgICAgICAgICAgICApKVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUGFyYW1zRXJyb3IoJ3RoZSB2YWx1ZSBvZiByYW5nZSBmaWVsZCBpbiBvcHRpb25zIGZvciBlbnVtIHR5cGUgaXMgaW52YWxpZC4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGFydFZhbGlkYXRlUHJvY2VkdXJlKCkge1xuICAgICAgICB0aGlzLnRyeUNhc3RUeXBlKCk7XG4gICAgICAgIHRoaXMudmVyaWZ5VHlwZSgpO1xuICAgICAgICB0aGlzLnZlcmlmeUJ1c2luZXNzVHlwZSgpO1xuICAgICAgICB0aGlzLnJ1blZhbGlkYXRvcigpO1xuICAgIH1cblxuICAgIHRyeUNhc3RUeXBlKCkge1xuICAgICAgICBjb25zdCB7IHZhbHVlIH0gPSB0aGlzLmN1cnJlbnRGaWVsZEluZm87XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIC9eW1xcZF0rJC8udGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudEZpZWxkSW5mby52YWx1ZSA9IE51bWJlcih2YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB2ZXJpZnlUeXBlKCkge1xuICAgICAgICBjb25zdCB7IHZhbHVlLCBuYW1lIH0gPSB0aGlzLmN1cnJlbnRGaWVsZEluZm87XG4gICAgICAgIGlmICghaXNOdW0odmFsdWUpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgUGFyYW1zRXJyb3IoYHRoZSB0eXBlIG9mICR7bmFtZX0gaXMgbm90IG51bWJlci5gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZlcmlmeUJ1c2luZXNzVHlwZSgpIHtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgICAgYnVzaW5lc3NUeXBlLCBidXNpbmVzc1R5cGVFcnJNc2csIHJhbmdlLCB2YWx1ZSwgbmFtZSwgdHlwZVxuICAgICAgICB9XG4gICAgICAgICAgICA9IHRoaXMuY3VycmVudEZpZWxkSW5mbztcblxuICAgICAgICBpZiAoYnVzaW5lc3NUeXBlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID1cbiAgICAgICAgICAgICAgICBOdW1iZXJWYWxpZGF0b3IuZ2V0TGFtYmRhRXhwcmVzc0J5QnVzaW5lc3NUeXBlKGJ1c2luZXNzVHlwZSkodmFsdWUsIHJhbmdlKTtcbiAgICAgICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUGFyYW1zRXJyb3IoYnVzaW5lc3NUeXBlRXJyTXNnIHx8IGB0aGUgdmFsdWUgb2YgZmllbGQgJHtuYW1lfSBkb24ndCBtYXRjaCB0aGUgYnVzaW5lc3MgdHlwZSAke2J1c2luZXNzVHlwZX0gb2YgJHt0eXBlfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIGdldExhbWJkYUV4cHJlc3NCeUJ1c2luZXNzVHlwZShidXNpbmVzc1R5cGUpIHtcbiAgICAgICAgc3dpdGNoIChidXNpbmVzc1R5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2VudW0nOlxuICAgICAgICAgICAgICAgIHJldHVybiAodmFsdWUsIHJhbmdlKSA9PiAoXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID49IHJhbmdlWzBdICYmIHZhbHVlIDw9IHJhbmdlWzFdXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGB0aGUgYnVzaW5lc3MgdHlwZSBvZiAke2J1c2luZXNzVHlwZX0gZm9yIG51bWJlciBpcyBub3QgZGVmaW5lZC5gKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==